<ion-view view-title="登录">
  <ion-content class="padding">
    <form name="form" novalidate>
      <div class="list list-inset">
          <div class="item item-input" style="border-left:0px; border-top:0px; border-right:0px;">
            <label class="item-floating-label">
                <span class="input-label">手机号</span>
                <input type="text" placeholder="手机号码" ng-model="data.username" id="username" name="username" ng-pattern="emailRegx" ng-change="change()"> 
            </label>
            <button class="button button-positive" style="position:absolute; right:0px; bottom:1px; margin-right:1px;" ng-if="valcodeLogin" ng-click="getValidateCode()" ng-disabled = "fetchingValidateCode">
              {{fetchingValidateCode ? '重新获取' + leftTime + '秒' : '获取验证码'}}
            </button>
          </div>
          <p class="lfb-warn" ng-if="!form.username.$valid">
            <span><i class="icon ion-ios-close"></i>请输入正确的手机号码</span>
          </p>
          <label class="item item-input item-floating-label" style="border-left:0px; border-top:0px; border-right:0px;">
              <span class="input-label">{{valcodeLogin ? '验证码' : '密码'}}</span>
              <input type="{{valcodeLogin ? 'text' : 'password'}}" placeholder="{{valcodeLogin ? '验证码' : '密码'}}" id="password" name="password" 
                    ng-model="data.password" ng-minlength="valcodeLogin ? 4 : 8" ng-change="change()">
          </label>
          <p class="lfb-warn" ng-if="valcodeLogin ? false : !form.password.$valid">
              <span><i class="icon ion-ios-close"></i>密码最少8位</span>
          </p>
          <p class="lfb-warn" ng-if="loginError">
              <span><i class="icon ion-ios-close"></i>{{loginErrorText}}</span>
          </p>
      </div>
      <div class="button-bar">

        <button class="button button-positive" ng-click="valcodeLogin ? loginWithValidateCode() :login()" 
          ng-disabled="valcodeLogin ? false :(!form.password.$valid || !form.username.$valid)">登陆</button>
      </div>
      <div class="row" style="margin-top:5px;">
        <div class="col-25">
          <button class="button button-clear" style="width:100%;color:grey;height:100%;font-size:1em" ng-click="goSignup()">免费注册</button>
        </div>
        <div class="col-20">
        </div>
        <div class="col-10">
        </div>
        <div class="col-50">
            <ion-toggle ng-model="valcodeLogin" toggle-class="toggle-positive" style="width:100%; height:100%; border:0px; font-size:1em">验证码登录</ion-toggle>
        </div>
      </div>
    </form>
  </ion-content>
</ion-view>